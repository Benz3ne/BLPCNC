## Mach4: Outputs Engage At Enable + UI Control — Root Cause and Minimal Fixes

Problem
- After enabling, dust collector and vacuums energize; UI buttons seem ineffective.

Design Principle
- Libraries: single source of truth for execution (read signals/PVs, compute desired from provided policy, write outputs safely).
- Scripts (ScreenLoad/PLC): own logic/policy (auto rules, defaults), call libs to execute.

Root Causes
- PLC policy at startup: `PLC_Init` sets Auto defaults (`#400=1` dust, `#402=1` boot) and immediately calls `AuxLib.Update(inst)`. If controller reports `spindle==on` or `inCycle==1` at that instant, outputs energize before UI stabilizes.
- Auto policy + target mirroring: While Auto is ON, AuxLib mirrors desired into manual target PVs. Turning Auto OFF later leaves targets latched, so devices stay ON; this looks like “buttons don’t work.”
- Enable-time timing/latch: Spindle/inCycle can be transiently true during/after Enable; the early Update amplifies this.

Minimal Fixes (correct and scoped)
- PLC.txt (policy/timing)
  - Remove the immediate `AuxLib.Update(inst)` from `PLC_Init` after setting PV defaults. Let the first PLC_Tick drive updates once UI and signals are stable.
  - Optional safer default: initialize with Auto OFF (`#400=0`, `#402=0`) to avoid any unintended actuation on first enable. Keep manual targets 0.
- ScreenLoad.txt (logic)
  - Keep device registration logic here. If desired, tighten dust Auto to require spindle direction AND in-cycle:
    - `auto = function(ctx) return ((mc.mcSpindleGetDirection(inst) ~= 0) and ctx.inCycle == 1) and 1 or 0 end`
- AuxLib.txt (execution)
  - Gate execution by machine enabled: if `OSIG_MACHINE_ENABLED` != 1, force `desired = 0` (don’t energize while disabled) and skip mirroring.
  - Remove the “mirror desired into pv.target” behavior when in Auto. Mirroring is policy; leaving it out ensures Auto OFF immediately hands control to manual targets (which remain unchanged unless scripts explicitly set them).

Why This Fix Addresses The Root Cause
- Eliminates enable-time races by deferring the first write until after UI/signal stabilization.
- Keeps policy decisions (when Auto should apply) in scripts, not in the library executor.
- Prevents silent actuation while disabled and avoids latching manual targets from Auto decisions.
- Makes Auto OFF immediately effective without extra UI steps, because the library no longer preserves a latched manual target implicitly.

Validation
- With machine disabled, no device toggles outputs regardless of PV changes.
- Enable with spindle OFF and not in-cycle: devices remain OFF.
- Turn dust Auto ON, start a program (spindle ON + inCycle): dust turns ON; stop program: dust turns OFF.
- Turn dust Auto OFF: device remains controlled only by manual target PV; manual buttons toggle reliably.
